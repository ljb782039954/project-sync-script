# 文件同步工具需求

一个用于将原始项目（中文注释）自动同步到目标项目（英文项目）的工具，支持通过 Git 检测变更文件并生成详细的同步日志。

## 功能特性

- ✅ **智能变更检测**：通过 Git 自动识别新增、修改、删除的文件
- ✅ **详细日志记录**：每次同步生成独立的日志文件，记录所有变更和文件路径
- ✅ **路径灵活性**：支持绝对路径和相对路径
- ✅ **配置文件支持**：通过 `config.json` JSON 配置文件管理路径，支持多个目标路径, 和忽视指定的文件和文件夹
- ✅ **跨平台支持**：提供 PowerShell（Windows）和 Bash（Linux/Mac/Git Bash）两个版本
- ✅ **自动化集成**：通过 Git Hook 实现自动同步
- ✅ **文件删除处理**：自动处理源项目中删除的文件
- ✅ **依赖检查**：启动时自动检查必要的工具（Git、robocopy/rsync等）
- ✅ **配置验证**：启动时验证配置文件的完整性和正确性
- ✅ **日志管理**：支持自动清理旧日志文件，可配置保留数量
- ✅ **同步预览**：支持预览模式，显示将要同步的文件而不执行实际操作
- ✅ **用户确认**：支持同步前用户确认，避免误操作
- **git忽视文件夹**：在源项目和目标项目的.gitignore文件中添加`.syncScript_logs/`，以实现忽视日志文件夹。


## 同步模式

- **手动完全同步**：使用 `--all` 参数触发，可以将当前项目中的所有文件和代码同步至目标项目（排除 `.gitignore` 中标记的文件、`syncScript` 文件夹、`.git` 目录和 `.syncScript_logs` 目录）
- **Git Hook触发（增量同步）**：每次 `git commit` 时会依据 git 变更日志，将原始项目中新增和修改的文件同步至目标项目中，并且也会将原始项目被删除的文件在目标项目中进行删除。

**重点**: 
- 原始项目中应该包含 `syncScript` 项目脚本，以及 Git Hook 配置，以此满足手动和自动同步
- Git Hook 模板位于 `syncScript/.git_hooks/` 目录，脚本会自动安装到 `.git/hooks/` 目录
- `syncScript` 文件夹不会同步到目标项目，但目标项目中会自动创建 `.syncScript_logs` 目录用于存放日志

## 同步日志

- **.syncScript_logs**：用于记录同步日志（git变更日志）
  - 源项目日志：`源项目根目录/.syncScript_logs/sync_目标项目名_YYYYMMDD_HHMMSS.txt`
  - 目标项目日志：`目标项目根目录/.syncScript_logs/sync_YYYYMMDD_HHMMSS.txt`
  - 每次同步会在源项目和目标项目各生成一份日志文件，方便快速查看变更文件


## 安装和配置

### 1. 准备项目目录

- **原始项目**：您编写代码的目录（包含中文注释）
- **目标项目**：用于同步到 GitHub 的目录（将翻译为英文），可以配置多个目标路径

### 2. 复制同步脚本

将`syncScript`文件夹和`gitHook`配置文件复制到您的项目根目录。


### 3. 创建配置文件

在脚本所在目录创建 `config.json` 文件，配置路径信息：

```json
{
  "source_path": "F:\\person\\copyUpdateFiles\\source_path",
  "target_paths": {
    "default": "F:\\person\\target_path\\test\\target-test-path",
    "version2": "F:\\person\\target_path\\version2\\target-test-path"
  },
  "exclude_patterns": [
    "*.log",
    "*.tmp",
    "node_modules/",
    "dist/",
    "build/",
    "test-pattern.js",
    ".gitignore"
  ],
  "log_retention": {
    "max_logs": 30,
    "auto_cleanup": true
  },
  "sync_options": {
    "preview_mode": false,
    "require_confirmation": false
  }
}
```

## 新增功能说明

### 依赖检查
- 启动时自动检查 Git、robocopy（Windows）/rsync（Linux）等必要工具
- 如果缺少工具会给出明确的错误提示和安装建议

### 配置验证
- 验证配置文件格式和必要字段
- 检查源路径是否存在
- 验证日志保留配置的合理性

### 日志管理
- `max_logs`: 设置保留的最大日志文件数量（默认30个）
- `auto_cleanup`: 是否自动清理旧日志文件（默认true）
- 清理时会保留最新的日志文件，删除较旧的文件

### 同步预览和确认
- `preview_mode`: 启用预览模式，只显示将要同步的文件，不执行实际操作
- `require_confirmation`: 同步前需要用户确认
- 支持命令行参数：`--preview`（预览模式）、`--confirm`（需要确认）

### 命令行参数
```bash
# Windows PowerShell
.\sync_to_target.ps1 --all          # 完全同步
.\sync_to_target.ps1 --preview      # 预览模式
.\sync_to_target.ps1 --confirm      # 需要确认
.\sync_to_target.ps1 --all --preview # 完全同步预览

# Linux/Mac/Git Bash
./sync_to_target.sh --all           # 完全同步
./sync_to_target.sh --preview       # 预览模式
./sync_to_target.sh --confirm       # 需要确认
./sync_to_target.sh --all --preview # 完全同步预览
```

**注意**：
1. 如果目标路径不存在则自动创建
2. 一切路径以 config 配置中的为准，不要在命令行中输入路径
3. 日志文件会在源项目和目标项目各保存一份
4. `syncScript` 文件夹不会同步到目标项目，但目标项目中会自动创建 `.syncScript_logs` 目录
5. 命令行参数会覆盖配置文件中的相应设置
